mode  server
proto <%= l2vpn_server.protocol == 'tcp' ? 'tcp-server' : 'udp' %>

port  <%=h l2vpn_server.port %>
<% if !l2vpn_server.bindall %>
 local <%=h l2vpn_server.ip %>
<% end %>

<% if l2vpn_server.protocol == 'udp' and !l2vpn_server.mtu.nil? %>
 fragment <%=h l2vpn_server.mtu - 8 %>
<% end %>
<% if !l2vpn_server.mtu_disc.nil? and !l2vpn_server.mtu_disc.blank? %>
 mtu-disc <%=h l2vpn_server.mtu_disc %>
<% end %>

dev   <%=h l2vpn_server.tap.name %>
dev-type  tap

log-append  /var/log/openvpn/<%=h l2vpn_server.name.gsub(" ", "_") + '.log' %>
status      /var/log/openvpn/<%=h l2vpn_server.name.gsub(" ", "_") + '.stats' %>

<% if l2vpn_server.cipher != 'none' %>
tls-server
cipher      <%=h l2vpn_server.cipher %>
ca          /etc/openvpn/<%=h ca_name  + '-ca-crt.pem' %>
#crl-verify /etc/openvpn/<%=h ca_name  + '-crl.pem ' %>
cert        /etc/openvpn/<%=h ca_name  + '-server-crt.pem ' %>
key         /etc/openvpn/<%=h ca_name  + '-server-key.pem ' %>
dh          /etc/openvpn/<%=h ca_name  + '-dh1024.pem' %>
tls-auth    /etc/openvpn/<%=h ca_name  + '-tls-data-key.pem 0' %>
<% end %>

keepalive    5 15

comp-lzo

user         nobody
group        nogroup

persist-key
persist-tun

verb         1
mute         20

management      127.0.0.1 12122 /path/to/<%=h l2vpn_server.name.gsub(" ", "_") + '-management-pass'%>
management-forget-disconnect
