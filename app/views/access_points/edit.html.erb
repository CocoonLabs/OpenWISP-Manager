<% content_for :after_defaults do %>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <%= javascript_include_tag 'owm.gmaps' %>
<% end  %>

<div class="grid_16">
  <div class="box">
    <h4><a><%= t(:Editing_access_point) %> -  <%=h @access_point.name %> - <%=h @wisp.name %></a></h4>
  </div>
</div>
<div class="clear">&nbsp;</div>

<div class="grid_10 prefix_3 suffix_3">
  <div class="box">
    <h2><a href="#" id="toggle-forms"><%=h t(:Editing_access_point) %></a></h2>
    <ul class="nav main">
      <li>
        <%= link_to t(:Back),:back %>
      </li>
    </ul>
    <div class="clear">&nbsp;</div>
    <div class="block" id="access_point_block">
      <% form_for([@wisp, @access_point]) do |f| %>
          <p><%= f.error_messages %></p>
          <fieldset>
            <legend><%=t :General_infos %></legend>
            <p>
              <%= f.label t(:Name)  %>
              <%= f.text_field :name, :maxlength => 32 %>
              <br>
            </p>
            <p>
              <%= f.label t(:AccessPoint_template)  %>
              <br>
              <%=
                  select( 'access_point_template',
                          :id,
                          @access_point_templates.collect { |ht| [ ht.name, ht.id.to_s ] },
                          { :selected => @selected_access_point_template, :include_blank => '' },
                          { :disabled => true }
                  )
              %>
            </p>
<%#
            <p>
              <%= f.label t(:AccessPoint_groups)  % >
              <br>
              <%=
                  select_tag( 'access_point_groups[]',
                              options_for_select(@access_point_groups.collect { |hg| [ hg.name, hg.id.to_s ] },
                                                 @selected_access_point_groups),
                              :multiple => true
                  )
              % >
            </p>
%>
            <p>
              <%= f.label t(:Mac_address)  %>
              <br>
              <%= f.text_field :mac_address, :maxlength => 17 %>
            </p>
            <p>
              <%= f.label t(:internal), t(:Internal_qm) %>
              <br>
              <%= f.check_box :internal %>
            </p>
            <p>
              <%= f.label t(:Activation_date) %>
              <br>
              <%= f.date_select :activation_date %>
            </p>
            <p>
              <%= f.label t(:Notes) %>
              <br>
              <%= f.text_area :notes, :rows => 3 %>
            </p>

          </fieldset>

          <fieldset>
            <legend>
              <%=t :Position_infos %>
            </legend>
            <p>
              <%= f.label t(:City) %>
              <br>
              <%= f.text_field :city, :maxlength => 20 %>
            </p>
            <p>
              <%= f.label t(:Address) %>
              <br>
              <%= f.text_field :address, :maxlength => 45 %>
            </p>
            <p>
              <%= f.label t(:Zip) %>
              <br>
              <%= f.text_field :zip, :maxlength => 15 %>
            </p>
            <p>
              <%=t :Adjust_position %>
              <br>
            </p>
            <span class="lat"><%= @access_point.lat %></span>
            <span class="lon"><%= @access_point.lon %></span>
            <div id="access_point_edit_map"></div>
            <p>
              <%= f.submit t(:Update) %>
            </p>
            <%= f.hidden_field :lat %>
            <%= f.hidden_field :lon %>
          </fieldset>
      <% end %>
    </div>
  </div>
</div>
<div class="clear">&nbsp;</div>

<%=
    observe_fields ['#access_point_city', '#access_point_address', '#access_point_zip'],
                   :frequency => 1,
                   :function => "gmaps.geocode({city:'#access_point_city', address:'#access_point_address', zip:'#access_point_zip'})"
%>
