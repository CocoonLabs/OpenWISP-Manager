if @map and @marker and @latlon
  page << @map.clear_overlays 
  page << @marker_variable << "=" << @marker.create

  @near_aps.each do |ap|
    page << @map.add_overlay(ap)
  end

  page << "#{@map_variable}.addOverlay(#{@marker_variable});"
  page << "GEvent.addListener(#{@marker_variable},\"dragend\",gmap_update_position);"
  page << @map.set_center(@latlon, @zoom)
  page << "gmap_update_position();"
end
